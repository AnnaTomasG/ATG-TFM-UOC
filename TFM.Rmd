---
title: 'TFM'
author: "Anna Tomas Gasco"
output:
  pdf_document:
    number_sections: no
    toc: yes
    toc_depth: 3
  html_document:
    toc: yes
    toc_depth: 3
  word_document:
    toc: yes
    toc_depth: '3'
---
\pagebreak
```{r echo=FALSE}
#Debemos escribir este comando para que nos accepte las tildes. 
Sys.setenv(LANGUAGE="es")

```

\pagebreak

```{r echo=FALSE,warning=FALSE,message=FALSE}
#Cargamos las librerias que necesitaremos


library(knitr)
library(kableExtra)
library(class)

library(ggplot2)


library(stats)
library(lattice)
library(expss)

set.seed(67637)

```

#### Anàlisi exploratori

Primer carreguem les dades

```{r message=FALSE, warning=FALSE}

hf<-read.csv(file="C:/Users/Anna/Documents/Anna/UOC/TFM/Datasets/A_POSSIBLES/Heart Failure/heart_failure_clinical_records_dataset.csv",header = TRUE, sep = ",")


```


***

Exploració taula

```{r message=FALSE, warning=FALSE}

head(hf)

```

resum variables
```{r message=FALSE, warning=FALSE}

str(hf)


```

substituim els 0 i 1 per paraules en el vector del sexe per obtenir uns resultats més visuals de les taules de contingencia

S'ha de crear nnou data frame per no interferir amb el estudi de cluster****
```{r message=FALSE, warning=FALSE}



#hf$sex<-replace(hf$sex,hf$sex==0,"Female")
#hf$sex<-replace(hf$sex,hf$sex==1,"Male")
#hf$sex
#head(hf)

```
### **1.Exploració dades categòriques**
taules de contingencia
```{r message=FALSE, warning=FALSE}

hf=apply_labels(hf,
                sex="sex",
                sex=c("Female"=0,"Male"=1),
                anaemia="anemia",
                diabetes="diabetes",
                high_blood_pressure="hipertensio arterial",
                smoking="fumador")
# cro(hf$anaemia,hf$sex)
# cro(hf$diabetes,hf$sex)
# cro(hf$high_blood_pressure,hf$sex)
# cro(hf$smoking,hf$sex)

cro_rpct(hf$sex, list(hf$anaemia,hf$diabetes,hf$high_blood_pressure,hf$smoking))


# cro(hf$DEATH_EVENT,hf$sex)
# cro(hf$DEATH_EVENT,hf$smoking)
# 
# cro(hf$sex,hf$DEATH_EVENT)
# 
cro(hf$anaemia,hf$DEATH_EVENT,hf$sex)
cro(hf$diabetes,hf$DEATH_EVENT,hf$sex)
cro(hf$high_blood_pressure,hf$DEATH_EVENT,hf$sex)
cro(hf$smoking,hf$DEATH_EVENT,hf$sex)


cro_cpct(hf$DEATH_EVENT,hf$sex, list(hf$anaemia,hf$diabetes,hf$high_blood_pressure,hf$smoking))



```


Proba: agafo 2 mostres random de 100 homes i 100 dones per veure si hi ha diferencies ja que les poblacions d'homes i dones son molt diferents


```{r message=FALSE, warning=FALSE}

 normhf<-rbind(hf[sample(which(hf$sex==0),100),],hf[sample(which(hf$sex==1),100),])
# hf[sample(which(hf$sex==0),100),]
normhf


str(normhf)
```


taules de contingencia
```{r message=FALSE, warning=FALSE}

#  normhf=apply_labels(normhf,
#                 sex="sex",
#                 sex=c("Female"=0,"Male"=1),
#                 anaemia="anemia",
#                 diabetes="diabetes",
#                 high_blood_pressure="hipertensio arterial",
#                 smoking="fumador")



# cro(hf$anaemia,hf$sex)
# cro(hf$diabetes,hf$sex)
# cro(hf$high_blood_pressure,hf$sex)
# cro(hf$smoking,hf$sex)

cro_rpct(normhf$sex, list(normhf$anaemia,normhf$diabetes,normhf$high_blood_pressure,normhf$smoking))


# cro(hf$DEATH_EVENT,hf$sex)
# cro(hf$DEATH_EVENT,hf$smoking)
# 
# cro(hf$sex,hf$DEATH_EVENT)
# 
cro(hf$anaemia,hf$DEATH_EVENT,hf$sex)
cro(hf$diabetes,hf$DEATH_EVENT,hf$sex)
cro(hf$high_blood_pressure,hf$DEATH_EVENT,hf$sex)
cro(hf$smoking,hf$DEATH_EVENT,hf$sex)


cro_cpct(hf$DEATH_EVENT,hf$sex, list(hf$anaemia,hf$diabetes,hf$high_blood_pressure,hf$smoking))



```



Prova: agafo 2 mostres random de 50 homes i 50 dones per veure si hi ha diferencies 


```{r message=FALSE, warning=FALSE}

 normhf50<-rbind(hf[sample(which(hf$sex==0),50),],hf[sample(which(hf$sex==1),50),])
# hf[sample(which(hf$sex==0),100),]
normhf50


str(normhf50)
```


taules de contingencia
```{r message=FALSE, warning=FALSE}

#  normhf=apply_labels(normhf,
#                 sex="sex",
#                 sex=c("Female"=0,"Male"=1),
#                 anaemia="anemia",
#                 diabetes="diabetes",
#                 high_blood_pressure="hipertensio arterial",
#                 smoking="fumador")



# cro(hf$anaemia,hf$sex)
# cro(hf$diabetes,hf$sex)
# cro(hf$high_blood_pressure,hf$sex)
# cro(hf$smoking,hf$sex)

cro_rpct(normhf50$sex, list(normhf50$anaemia,normhf50$diabetes,normhf50$high_blood_pressure,normhf50$smoking))


# cro(hf$DEATH_EVENT,hf$sex)
# cro(hf$DEATH_EVENT,hf$smoking)
# 
# cro(hf$sex,hf$DEATH_EVENT)
# 
cro(hf$anaemia,hf$DEATH_EVENT,hf$sex)
cro(hf$diabetes,hf$DEATH_EVENT,hf$sex)
cro(hf$high_blood_pressure,hf$DEATH_EVENT,hf$sex)
cro(hf$smoking,hf$DEATH_EVENT,hf$sex)


cro_cpct(hf$DEATH_EVENT,hf$sex, list(hf$anaemia,hf$diabetes,hf$high_blood_pressure,hf$smoking))



```
Una manera de representar les taules de contingencia

```{r message=FALSE, warning=FALSE}

head(hf)

#Bar charts stacked
ggplot(hf,aes(x=anaemia, fill=sex) )+ geom_bar()
ggplot(hf,aes(x=diabetes, fill=sex) )+ geom_bar()
ggplot(hf,aes(x=high_blood_pressure, fill=sex) )+ geom_bar()
ggplot(hf,aes(x=smoking, fill=sex) )+ geom_bar()
ggplot(hf,aes(x=DEATH_EVENT, fill=sex) )+ geom_bar()


#Bar charts not stacked
ggplot(hf,aes(x=anaemia, fill=sex) )+ geom_bar(position = "dodge")
ggplot(hf,aes(x=diabetes, fill=sex) )+ geom_bar(position = "dodge")
ggplot(hf,aes(x=high_blood_pressure, fill=sex) )+ geom_bar(position = "dodge")
ggplot(hf,aes(x=smoking, fill=sex) )+ geom_bar(position = "dodge")
ggplot(hf,aes(x=DEATH_EVENT, fill=sex) )+ geom_bar(position = "dodge")


```

Mostrant les proporcions de manera gràfica


```{r message=FALSE, warning=FALSE}

ggplot(hf,aes(x=anaemia, fill=sex) )+ geom_bar(position = "fill") + ylab("proportion")
ggplot(hf,aes(x=diabetes, fill=sex) )+ geom_bar(position = "fill") + ylab("proportion")
ggplot(hf,aes(x=high_blood_pressure, fill=sex) )+ geom_bar(position = "fill") + ylab("proportion")
ggplot(hf,aes(x=smoking, fill=sex) )+ geom_bar(position = "fill") + ylab("proportion")
ggplot(hf,aes(x=DEATH_EVENT, fill=sex) )+ geom_bar(position = "fill") + ylab("proportion")

```


Distribucions per a una variable (marginal distribution)
```{r message=FALSE, warning=FALSE}
#distribució per a les variables
ggplot(hf,aes(x=anaemia) )+ geom_bar()


#distribució segons sexe
ggplot(hf,aes(x=anaemia) )+ geom_bar()+facet_wrap(~sex)
ggplot(hf,aes(x=diabetes) )+ geom_bar()+facet_wrap(~sex)
ggplot(hf,aes(x=high_blood_pressure) )+ geom_bar()+facet_wrap(~sex)
ggplot(hf,aes(x=smoking) )+ geom_bar()+facet_wrap(~sex)
ggplot(hf,aes(x=DEATH_EVENT) )+ geom_bar()+facet_wrap(~sex)

```

### **2. Exploració Dades numériques**

Faceted histogram

```{r message=FALSE, warning=FALSE}
head(hf)

ggplot(hf, aes(x = age)) +
  geom_histogram() +
  facet_wrap(~ sex)

ggplot(hf, aes(x = creatinine_phosphokinase )) +
  geom_histogram() +
  facet_wrap(~ sex)


ggplot(hf, aes(x = ejection_fraction )) +
  geom_histogram() +
  facet_wrap(~ sex)

ggplot(hf, aes(x = platelets )) +
  geom_histogram() +
  facet_wrap(~ sex)

ggplot(hf, aes(x = serum_creatinine )) +
  geom_histogram() +
  facet_wrap(~ sex)

ggplot(hf, aes(x = serum_sodium )) +
  geom_histogram() +
  facet_wrap(~ sex)



```
Perfils similars

Plaquetes augmentar en resposta a una inflamació, anèmia per dèficit de ferro

robar mes convinacions per trobar discrepancies
```{r message=FALSE, warning=FALSE}
ggplot(hf, aes(x = platelets )) +
  geom_histogram() +
  facet_wrap(~ anaemia)



ggplot(hf, aes(x = serum_sodium )) +
  geom_histogram() +
  facet_wrap(~ anaemia)

ggplot(hf, aes(x = creatinine_phosphokinase )) +
  geom_histogram() +
  facet_wrap(~ anaemia)


ggplot(hf, aes(x = age )) +
  geom_histogram() +
  facet_wrap(~ anaemia)



ggplot(hf, aes(x = ejection_fraction )) +
  geom_histogram() +
  facet_wrap(~ anaemia)



ggplot(hf, aes(x = age )) +
  geom_histogram() +
  facet_wrap(~ anaemia)

```

####Anàlisi de clusters





### **2. Clustering jerarquic**

Escalem variables

```{r message=FALSE, warning=FALSE}

hfscaled<-scale(hf)
hfscaled


```


Primer es calculen les distancies 



```{r message=FALSE, warning=FALSE}

distancies<- dist(hf, method="euclidean")

distanciesscal<-dist(hfscaled, method="euclidean")

```
Clusters matriu no escalada
```{r message=FALSE, warning=FALSE}

clusterH<-hclust(distancies, method = "ward")

plot(clusterH)

```

```{r message=FALSE, warning=FALSE}
clustergrups<-cutree(clusterH, k=5)

```
Cluster matriu escalada
```{r message=FALSE, warning=FALSE}

clusterHS<-hclust(distanciesscal, method = "ward")

plot(clusterHS)

```










```{r message=FALSE, warning=FALSE}
boxplot(pres~trat,data=presiones,xlab="Tratamiento",ylab="Presión arterial sistólica" )


```




***



### **2. **





$$\boldsymbol{y_{ij} = \mu + \alpha_i + \epsilon_{ij}}$$




#### **3.  **

\underline{Media}

***mean()***.
```{r warning=FALSE,message=FALSE}


```










